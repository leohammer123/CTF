# Natas11
In this level yuo need to know what is [XOR Encryption](https://stackoverflow.com/questions/2029426/what-is-xor-encryption)

```
a ^ b =c
a ^ c =b
b ^ c =a
a ^ a =0
a ^ 0 =a
```
Source code :
```php
<?

$defaultdata = array("showpassword"=>"no", "bgcolor"=>"#ffffff");

function xor_encrypt($in) {
    $key = '<censored>';
    $text = $in;
    $outText = '';

    // Iterate through each character
    for($i=0;$i<strlen($text);$i++) {
    $outText .= $text[$i] ^ $key[$i % strlen($key)];
    }

    return $outText;
}

function loadData($def) {
    global $_COOKIE;
    $mydata = $def;
    if(array_key_exists("data", $_COOKIE)) {
    $tempdata = json_decode(xor_encrypt(base64_decode($_COOKIE["data"])), true);
    if(is_array($tempdata) && array_key_exists("showpassword", $tempdata) && array_key_exists("bgcolor", $tempdata)) {
        if (preg_match('/^#(?:[a-f\d]{6})$/i', $tempdata['bgcolor'])) {
        $mydata['showpassword'] = $tempdata['showpassword'];
        $mydata['bgcolor'] = $tempdata['bgcolor'];
        }
    }
    }
    return $mydata;
}

function saveData($d) {
    setcookie("data", base64_encode(xor_encrypt(json_encode($d))));
}

$data = loadData($defaultdata);

if(array_key_exists("bgcolor",$_REQUEST)) {
    if (preg_match('/^#(?:[a-f\d]{6})$/i', $_REQUEST['bgcolor'])) {
        $data['bgcolor'] = $_REQUEST['bgcolor'];
    }
}

saveData($data);



?>

```
The main idea of the code is to encrypted {"showpassword"=>"no", "bgcolor"=>"#ffffff"} and then set it to the cookie, According to the formula above, we know that we can xor cipher and paintext to get the encrypt key, modified the plaintext and use the same key to encrypt it. 
It might take a long time to figure out what happened but it surely worth the time you spend.<br>
## [script answer](https://github.com/leohammer123/CTF/blob/main/overthewire/Natas/src/level11.py)
<br>flag:EDXp0pS26wLKHZy1rDBPUZk0RKfLGIR3
## Natas12
[File upload Vulnerability](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload)
## In the Source code
```php
  if(filesize($_FILES['uploadedfile']['tmp_name']) > 1000) {
        echo "File is too big";
    } else {
        if(move_uploaded_file($_FILES['uploadedfile']['tmp_name'], $target_path)) {
            echo "The file <a href=\"$target_path\">$target_path</a> has been uploaded";
        } else{
            echo "There was an error uploading the file, please try again!";
        }
``` 

## In the html 
```html
<input type="hidden" name="filename" value="<? print genRandomString(); ?>.jpg" />
```
The server get the post filename without any check so you can modified it to some other suffix such as .html or .php which can render by the browser.

## [php payload](https://github.com/leohammer123/CTF/blob/main/overthewire/Natas/src/level12.php)
<br>flag:jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY
# Natas13
In this level they add a exif_imagetype to check if the file is picture or not,but this function only check the [magic byte](https://www.netspi.com/blog/technical/web-application-penetration-testing/magic-bytes-identifying-common-file-formats-at-a-glance/) of the file. So it's actully very weak. Just adding some bytes in the file the function will identify php file as image.
## [python3 script to add bytes](https://github.com/leohammer123/CTF/blob/main/overthewire/Natas/src/level13.py)
## [final file](https://github.com/leohammer123/CTF/blob/main/overthewire/Natas/src/level13.php)
flag:Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1
# Natas14
## [SQL injection](https://portswigger.net/web-security/sql-injection)
```
name : natas15" --  #space are required
password : what ever you want
```
flag:AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J
# Natas15
In this level we have to do an [SQL injection UNION attack](https://portswigger.net/web-security/sql-injection/union-attacks) , insteat of test for many times we use [sqlmap](https://sqlmap.org/) to get users table's value.
```
 sqlmap -u "http://natas15.natas.labs.overthewire.org/index.php?debug" --string="This user exists" --auth-type=Basic --auth-cred=natas15:AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J --data "username=natas16" --level=5 --risk=3 -D natas15 -T users -C username,password --dump   
```
We have the following table.
![img](https://github.com/leohammer123/CTF/blob/main/overthewire/Natas/image/table.png)                                                                              
flag:WaIHEacj63wnNIBROHeqi3p9t0m5nhmh    


 


